


<div class="quiz_backg" id="quiz_backg" >


    <div class="quiz_text">

        <h1><i><strong>Welcome to {{ @moduleData.module_name }}!</strong></i></h1>


        <button id="show_reading" class="quiz_button">Teach me something about {{ @moduleData.module_name }} first!</button>

        <div id="reading" style="display:none;">
            <br/>
            <p>{{ @moduleData.module_text | raw }}</p>
        </div>

        <br/>
        <br/>
        <h3><i>Quiz time!</i></h3>
        <br/>



        <repeat group="{{ @questions }}" value="{{ @question }}">
            <div>
            <p>{{ trim(@question.question) }}</p>
                <div class="row">
                    <div class="col-lg-4">
                        <label class="option"><input type="radio" name="{{ @question.question_number }}" value="1">  A. {{ @question.option_1 }}</label>
                    </div>
                    <div class="col-lg-8">
                        <label class="option"><input type="radio" name="{{ @question.question_number }}" value="2">  B. {{ @question.option_2 }}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4">
                        <label class="option"><input type="radio" name="{{ @question.question_number }}" value="3">  C. {{ @question.option_3 }}</label>
                    </div>
                    <div class="col-lg-8">
                        <label class="option"><input type="radio" name="{{ @question.question_number }}" value="4">  D. {{ @question.option_4 }}</label>
                    </div>
                </div>

                <br>
            <div class="answers" id="{{ @question.question_number }}"></div>

            </div>
            <br>
        </repeat>
        <button class="quiz_button" id="check_answers" onclick="checkAllAnswers()"> Check your answers </button>

<!--        https://stackoverflow.com/questions/2906582/how-to-create-an-html-button-that-acts-like-a-link-->
        <button class="quiz_button after_check" id="try_again" onclick="location.href='{{ @BASE}}/quiz'">Try again</button>
        <button class="quiz_button after_check" id="next_module" onclick="goToNextQuiz()">Next quiz</button>




        <!-- The Modal -->
        <!--from https://www.w3schools.com/howto/howto_css_modals.asp-->
        <div id="results_modal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <span class="close">&times;</span>
                <div class="modal-content2">
                    <h3 id="modal_message"></h3>
                    <img class="modal_stars" id="modal_stars"/>
                    <h5 id="how_many"></h5>
                    <p id="instructions">Go back to the quiz to see your answers or to move on.</p>
                </div>
            </div>
        </div>

        <div id="snackbar">The next quiz is still in the works!</div>
    </div>



<!--    <div class="blob">-->
<!--        <img src="assets/img/blob.svg">-->
<!--    </div>-->

</div>







<script src="{{@BASE}}/ui/js/jquery.min.js"></script>
<script>

    $('.quiz_backg').scroll(function() {
        if ($(this).scrollTop() > 100) {
            $('#header').addClass('header-scrolled');
        } else {
            $('#header').removeClass('header-scrolled');
        }
    });

    $(document).ready(function(){
        $("#show_reading").click(function(){
            $("#reading").slideToggle();
        });
    });

    const backg = document.getElementById('quiz_backg');
    $(document).ready(function(){
        $.ajax({
            type: 'GET',
            url: "{{ @BASE }}/quiz/backg",
            async: false,
            success: function(response) {
                backg.style.background = "url("+ response +") center";
            },
            failure: function() {
                console.log("background failure");
            },
        });

    });

    // Get the modal
    const modal = document.getElementById("results_modal");

    let correctAnswers;

    async function checkAllAnswers() {
        correctAnswers = 0;
        for (var i = 1; i <= 5; i++) {
            checkAnswers(i);
        }
        openModal(correctAnswers);

        $.post("{{ @BASE }}/savepoints", {
                points: correctAnswers,
            },
            function(result){
                console.log(result);
            }
        );
    }

    function checkAnswers(qid) {
        //let correct = false;
        $.ajax({
            type: 'GET',
            url: "{{ @BASE }}/quiz/" + qid,
            async: false,
            success: function(response) {
                // https://stackoverflow.com/questions/596351/how-can-i-know-which-radio-button-is-selected-via-jquery
                let selected = $('input[name='+ qid +']:checked').val();

                if (parseInt(selected) === parseInt(response)) {
                    correctAnswers++;
                    $('#' + qid).html('Correct!');
                } else {
                    switch (parseInt(response)) {
                        case 1:
                            option = "A";
                            break;
                        case 2:
                            option = 'B';
                            break;
                        case 3:
                            option = 'C';
                            break;
                        case 4:
                            option = 'D';
                            break;
                    }
                    $('#' + qid).html('Incorrect! The correct answer is option '+ option);
                }

            },
            failure: function() {
                console.log("failure");
            },
        });


    }

    const results_message = {
        0: "Better luck next time!",
        1: "Better luck next time!",
        2: "That's not bad!",
        3: "That's not bad!",
        4: "Good job!",
        5: "Amazing!"
    };

    const star_images = {
        0: "assets/img/stars/Stars_0.svg",
        1: "assets/img/stars/Stars_1.svg",
        2: "assets/img/stars/Stars_2.svg",
        3: "assets/img/stars/Stars_3.svg",
        4: "assets/img/stars/Stars_4.svg",
        5: "assets/img/stars/Stars_5.svg"
    };

    const modal_stars = document.getElementById('modal_stars');
    const modal_message = document.getElementById('modal_message');
    const how_many = document.getElementById('how_many');

    //buttons
    const button_check = document.getElementById('check_answers');
    const button_again = document.getElementById('try_again');
    const button_next = document.getElementById('next_module');

    function openModal(correctAnswers) {
        modal_stars.src = star_images[correctAnswers];
        modal_message.innerHTML = results_message[correctAnswers];
        how_many.innerHTML = "You got " + correctAnswers + " out of 5 correct.";
        modal.style.display = "block";

        button_check.style.display = 'none';
        // positioning buttons side by side: https://stackoverflow.com/questions/27671709/position-buttons-next-to-each-other-in-the-center-of-page/37333329
        button_again.style.display = 'inline-block';
        button_next.style.display = 'inline-block';
    }

    // -------  MODAL  -------- //
    // from https://www.w3schools.com/howto/howto_css_modals.asp

    // Get the <span> element that closes the modal
    const span = document.getElementsByClassName("close")[0];

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function goToNextQuiz() {

        $.get("{{ @BASE }}/quiz/next",
            function(result){
                console.log(result);
                if (result == false) {

                    // Snackbar how to from https://www.w3schools.com/howto/howto_js_snackbar.asp
                    // Get the snackbar DIV
                    const x = document.getElementById("snackbar");

                    // Add the "show" class to DIV
                    x.className = "show";

                    // After 3 seconds, remove the show class from DIV
                    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);

                } else {
                    window.location.replace("{{ @BASE }}/quiz");
                }
            });
    }

</script>

